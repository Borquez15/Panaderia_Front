
<div class="productos-container">
  <!-- Header con logo -->
  <header class="productos-header">
    <div class="header-content">
      <div class="logo-section">
        <img src="/assets/images/logo.png" alt="Panadería el Dan" class="logo">
        <h1 class="title">Panadería el Dan</h1>
      </div>
      <button class="menu-btn" aria-label="Menú">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </header>

  <div class="main-content">
    <!-- Sidebar de categorías -->
    <aside class="categories-sidebar">
      <nav class="categories-nav">
        <button 
          class="category-btn"
          [class.active]="selectedCategory() === null"
          (click)="selectCategory(null)">
          <img src="/assets/images/categories/todas.jpg" alt="Todas">
          <span>Todas</span>
        </button>

        @for (category of categories(); track category.id) {
          <button 
            class="category-btn"
            [class.active]="selectedCategory() === category.id"
            (click)="selectCategory(category.id)">
            <img [src]="category.imagen_url || '/assets/images/placeholder.png'" 
                 [alt]="category.nombre">
            <span>{{ category.nombre }}</span>
          </button>
        }
      </nav>
    </aside>

    <!-- Grid de productos -->
    <main class="products-main">
      <!-- Barra de búsqueda y filtros -->
      <div class="search-bar">
        <div class="search-input-wrapper">
          <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
          <input 
            type="text" 
            class="search-input"
            placeholder="Buscar productos..."
            [(ngModel)]="searchQuery"
            (ngModelChange)="onSearch()">
        </div>
        
        <div class="filter-buttons">
          <button class="filter-btn">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
              <path d="M3 3a1 1 0 000 2h11a1 1 0 100-2H3zM3 7a1 1 0 000 2h5a1 1 0 000-2H3zM3 11a1 1 0 100 2h4a1 1 0 100-2H3z"/>
            </svg>
          </button>
          <button class="filter-btn">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
              <path d="M5 4a1 1 0 00-2 0v7.268a2 2 0 000 3.464V16a1 1 0 102 0v-1.268a2 2 0 000-3.464V4z"/>
            </svg>
          </button>
        </div>
      </div>

      @if (loading()) {
        <div class="loading-container">
          <div class="spinner"></div>
          <p>Cargando productos...</p>
        </div>
      } @else if (products().length === 0) {
        <div class="empty-state">
          <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
          </svg>
          <h3>No se encontraron productos</h3>
          <p>Intenta con otra búsqueda o categoría</p>
        </div>
      } @else {
        <!-- Grid de productos -->
        <div class="products-grid">
          @for (product of products(); track product.id) {
            <article class="product-card">
              <div class="product-image-container">
                <img 
                  [src]="product.imagen_url || '/assets/images/placeholder.png'" 
                  [alt]="product.nombre"
                  class="product-image">
                
                @if (tieneDescuento(product)) {
                  <span class="discount-badge">
                    -{{ calcularDescuento(product) }}%
                  </span>
                }

                <button class="favorite-btn" aria-label="Agregar a favoritos">
                  <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                  </svg>
                </button>
              </div>

              <div class="product-info">
                <h3 class="product-name">{{ product.nombre }}</h3>
                
                <div class="product-pricing">
                  @if (tieneDescuento(product)) {
                    <div class="price-group">
                      <span class="price-original">\${{ product.precio.toFixed(2) }}</span>
                      <span class="price-final">\${{ getPrecioFinal(product).toFixed(2) }}</span>
                    </div>
                  } @else {
                    <span class="price-final">\${{ product.precio.toFixed(2) }}</span>
                  }
                </div>

                <button 
                  class="add-to-cart-btn"
                  [disabled]="product.stock <= 0 || addingToCart() === product.id"
                  (click)="addToCart(product)">
                  @if (addingToCart() === product.id) {
                    <span class="btn-spinner"></span>
                  } @else if (product.stock <= 0) {
                    Agotado
                  } @else {
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                            d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
                    </svg>
                    <span>Agregar</span>
                  }
                </button>
              </div>
            </article>
          }
        </div>
      }
    </main>
  </div>
</div>
