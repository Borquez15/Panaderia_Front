<div class="carrito-container">
  <!-- Header -->
  <header class="carrito-header">
    <div class="header-content">
      <button class="back-btn" routerLink="/productos">
        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
      </button>
      <h1 class="page-title">Carrito de Compras</h1>
    </div>
  </header>

  @if (!cart() || cart()!.items.length === 0) {
    <!-- Carrito vac√≠o -->
    <div class="empty-cart">
      <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
              d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
      </svg>
      <h2>Tu carrito est√° vac√≠o</h2>
      <p>Agrega productos para comenzar tu compra</p>
      <button class="btn-primary" (click)="continueShopping()">
        Ver Productos
      </button>
    </div>
  } @else {
    <div class="carrito-content">
      <!-- Lista de productos -->
      <div class="cart-items-section">
        <div class="section-header">
          <h2>Productos ({{ cart()!.items.length }})</h2>
          <button class="clear-cart-btn" (click)="clearCart()">
            Vaciar carrito
          </button>
        </div>

        <div class="cart-items">
          @for (item of cart()!.items; track item.id) {
            <article class="cart-item" 
                     [class.removing]="removingItem() === item.id">
              <!-- Imagen del producto -->
              <div class="item-image">
                <img [src]="item.producto.imagen_url || '/assets/images/placeholder.png'" 
                     [alt]="item.producto.nombre">
              </div>

              <!-- Info del producto -->
              <div class="item-info">
                <h3 class="item-name">{{ item.producto.nombre }}</h3>
                @if (item.producto.descripcion) {
                  <p class="item-description">{{ item.producto.descripcion }}</p>
                }
                
                <div class="item-stock">
                  @if (item.producto.stock <= 5) {
                    <span class="stock-warning">
                      ‚ö†Ô∏è Solo quedan {{ item.producto.stock }} disponibles
                    </span>
                  } @else {
                    <span class="stock-available">‚úì En stock</span>
                  }
                </div>
              </div>

              <!-- Precio unitario -->
              <div class="item-price">
                <span class="price-label">Precio:</span>
                <span class="price-value">\${{ item.precio_unitario.toFixed(2) }}</span>
              </div>

              <!-- Cantidad -->
              <div class="item-quantity">
                <span class="quantity-label">Cantidad:</span>
                <div class="quantity-controls">
                  <button 
                    class="quantity-btn"
                    [disabled]="updatingItem() === item.id"
                    (click)="updateQuantity(item, item.cantidad - 1)">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M5 10a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1z" clip-rule="evenodd"/>
                    </svg>
                  </button>
                  
                  <span class="quantity-display">{{ item.cantidad }}</span>
                  
                  <button 
                    class="quantity-btn"
                    [disabled]="updatingItem() === item.id || item.cantidad >= item.producto.stock"
                    (click)="updateQuantity(item, item.cantidad + 1)">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"/>
                    </svg>
                  </button>
                </div>
              </div>

              <!-- Subtotal -->
              <div class="item-subtotal">
                <span class="subtotal-label">Subtotal:</span>
                <span class="subtotal-value">\${{ item.subtotal.toFixed(2) }}</span>
              </div>

              <!-- Bot√≥n eliminar -->
              <button 
                class="remove-btn"
                [disabled]="removingItem() === item.id"
                (click)="removeItem(item)"
                aria-label="Eliminar producto">
                @if (removingItem() === item.id) {
                  <span class="btn-spinner"></span>
                } @else {
                  <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
                  </svg>
                }
              </button>
            </article>
          }
        </div>
      </div>

      <!-- Resumen del pedido -->
      <aside class="order-summary">
        <div class="summary-card">
          <h2 class="summary-title">Resumen del Pedido</h2>

          <div class="summary-row">
            <span>Subtotal:</span>
            <span class="summary-value">\${{ subtotal().toFixed(2) }}</span>
          </div>

          <div class="summary-row">
            <span>Env√≠o:</span>
            @if (envio() === 0) {
              <span class="summary-value free">¬°Gratis!</span>
            } @else {
              <span class="summary-value">\${{ envio().toFixed(2) }}</span>
            }
          </div>

          @if (subtotal() > 0 && subtotal() < 500) {
            <div class="shipping-notice">
              <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
              </svg>
              <span>Agrega \${{ (500 - subtotal()).toFixed(2) }} m√°s para env√≠o gratis</span>
            </div>
          }

          <div class="summary-divider"></div>

          <div class="summary-total">
            <span>Total:</span>
            <span class="total-value">\${{ total().toFixed(2) }}</span>
          </div>

          <button class="btn-checkout" (click)="goToCheckout()">
            Proceder al Pago
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
            </svg>
          </button>

          <button class="btn-continue-shopping" (click)="continueShopping()">
            Seguir Comprando
          </button>

          <!-- M√©todos de pago aceptados -->
          <div class="payment-methods">
            <p class="payment-title">Aceptamos:</p>
            <div class="payment-icons">
              <span>üí≥</span>
              <span>üíµ</span>
              <span>üì±</span>
            </div>
          </div>
        </div>
      </aside>
    </div>
  }
</div>